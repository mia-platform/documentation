---
id: configuration
title: Configuration
sidebar_label: Configuration
---

import KangoSchema from "@site/static/schemas/fast_data/kango.0.5.2.schema.json"
import KangoConfigExample from "@site/static/schemas/fast_data/examples/kango.example.json"
import SchemaViewer from "@site/src/components/SchemaViewer"

In order to configure the service, a set of environment variables are adopted for
describing basic service needs, alongside a main configuration file.

## Environment Variables

| Variable                    | Description                                                                                                                | Default            |
|-----------------------------|----------------------------------------------------------------------------------------------------------------------------|--------------------|
| LOG_LEVEL                   | the maximum log level to emit. Accepted levels are  `trace`\|`debug`\|`info`\|`warn`\|`error`                              | `info`             |
| HTTP_PORT                   | the HTTP port on which kubernetes status routes and metrics are exposed                                                    | `3000`             |
| CONFIGURATION_FOLDER        | the filepath to the folder under which configuration files are located                                                     | `<HOME>/.df/kango` |
| OTEL_EXPORTER_OTLP_ENDPOINT | specify the OpenTelemetry OTLP endpoint where traces and metrics should be pushed. When not set, telemetry is not exported |                    |

:::info

Currently `<HOME>` value is set to `/home/kango`, which is based on how the service image is built.

:::

## Configuration File

The application needs a configuration file, named `config.json`, which respects
the following JSON schema configuration.

<SchemaViewer schema={KangoSchema} example={KangoConfigExample} />

Starting from version _v0.5.2_, the Kango configuration file supports the `connections` property, which can be used to create
references of Kafka connections and MongoDB connections and reuse them, respectively, inside the `consumer` property
and the `persistence` property.
This trait is similar to other Fast Data services like [Mongezium](/products/fast_data/fast_data_engine_v2/mongezium_cdc/10_Overview.md),
[FarmData](/products/fast_data/fast_data_engine_v2/farm_data/10_Overview.md) and [Kango](/products/fast_data/fast_data_engine_v2/kango/10_Overview.md),
and it will help you to better organize the structure of the configuration file, by placing connection information on one side, and configurations on the 
related places.

:::warning

While you can decide to define Kafka connections or Mongo connections either inside the `connections` property
or inside the related configuration section, please consider that we are going to move towards a configuration
structure where these configuration can only be included inside the `connections` property.

This update will be included in one of the next versions of Mongezium, therefore it is highly suggested to use `connections` property
as soon as you upgrade to _v0.4.3_ of Mongezium.

:::

In addition, Kafka configurations and MongoDB persistence properties support [**secret resolution**](/products/fast_data/fast_data_engine_v2/secrets_resolution.md).

:::note

The raw JSON schema can also be found <a target="_blank" href="/schemas/fast_data/kango.0.5.2.schema.json">here</a>.


:::

## Control Plane Support

The service implements the interface for connecting towards a Control-Plane Operator.  
However, complete [Runtime Management](/products/fast_data/runtime_management/overview.mdx) support, that is with Control Plane UI and
a central Control Plane instance will be added in the future.

## Recommended Kafka Configuration

When configuring Kafka consumer, it is advised to set appropriate values for
constraining the consumer internal queue. In this manner:

- the maximum amount of memory employed by the service can be finely tuned to avoid
  wasting resources, since only the number of messages that can effectively be
  processed in real-time should be pulled in memory;
- it is ensured that consumer continuously poll the broker to avoid it exiting the
  consumer group, since a lower number of buffered messages can trigger a new fetch to
  replenish it;

The main values to tune are:

- `queued.max.messages.kbytes`: maximum number of kilobytes of queued pre-fetched
  messages in the local consumer queue;
- `queued.min.messages`: minimum number of messages per topic+partition _librdkafka_
  tries to maintain in the local consumer queue;

It is recommended to set `queued.min.messages` to a value greater, but close to the
average message consumption rate. It is possible to observer:

- `kafka_consumer_rx_msgs_total` &rarr; messages read
- `ka_flushed_messages` &rarr; messages written to the persistence layer

to check the average values.

For _Kango_ service, when connected to a MongoDB M50 cluster instance, an example of configuration can be the following one:

```json
{
  "queued.max.messages.kbytes": "32840",
  "queued.min.messages": "5000"
}
```

Another important property that might need to be tuned is `fetch.message.max.bytes`,
which however should be changed only in case `queued.max.messages.kbytes` is set to
a value lower than `1024`.

## Kubernetes

### Resources

When the plugin is deployed on Kubernetes, it is advised to set its resources'
_requests_ and _limits_. Here are provided which are the recommended ones, although
they can be changed according to your needs:

#### Recommended

- _requests_:
  ```text
  CPU: 25m 
  Memory: 30MB
  ```
- _limits_:
  ```text
  CPU: 300m 
  Memory: 90MB
  ```

### Status Probes

The service exposes the `liveness` and `readines` status probes as HTTP endpoint, which
helps Kubernetes when the service is successfully started and when it may need to be restarted.

The endpoints are:

- `liveness` probe: `/-/healthz`
- `readiness` probe: `/-/ready`

