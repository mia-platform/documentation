---
id: custom_service
title: Custom Service
sidebar_label: Custom service
---

<!--
WARNING: this file was automatically generated by Mia-Platform Doc Aggregator.
DO NOT MODIFY IT BY HAND.
Instead, modify the source file and run the aggregator to regenerate this file.
-->

A Custom Microservice is a service that receives HTTP requests, whose cycle of use and deploy is managed by the platform. A Custom Microservice  encapsulates ad-hoc business logics that can be developed by any user of the platform. To know how manage your services in the DevOps Console see the [documentation](../../development_suite/api-console/api-design/services)

The library exports a function which creates the infrastructure ready to accept the definition of routes and decorators.  
The function optionally can take a schema of the required environment variables (you can find the reference [fastify-env](https://github.com/fastify/fastify-env).

## Example

```js
const customService = require('@mia-platform/custom-plugin-lib')({
  type: 'object',
  required: ['ENV_VAR'],
  properties: {
    ENV_VAR: { type: 'string' },
  },
})
```

> **_More examples?_** Go [here](https://github.com/mia-platform/custom-plugin-lib/blob/master/examples/advanced/index.js) to see another use cases.

You can configure the environment variables from DevOps console, in your service configuration. For further detail see [Mia-Platform documentation](../../development_suite/api-console/api-design/services#environment-variable-configuration).  

The customService function expects two arguments:

- an async function to initialize and configure the `service`, a [Fastify instance](https://www.fastify.io/docs/latest/Server/);
- an optional `serviceOptions` object useful for configuring the plugins used by the library.  

You can access the environment variables values from `service.config`:

```js
module.exports = customService(async function handler(service) {
  const { ENV_VAR } = service.config
  ...
}, serviceOptions)
```

Upon `service`, you can you can add [routes](./routes.md) and [decorators](./decorators.md).  

The `serviceOptions` argument supports the following properties:

- `ajv`: an object useful to customize certain configurations of the `ajv` instance used by the service:
  - `vocabulary`: a list of strings used to setup a custom keyword vocabulary,  
  keep in mind that if you whish to extend the OAS specification generated by your services and create a valid API specification, each
  vocabulary entry **must** start with the `x-` prefix, check out the [OAS specification](https://swagger.io/docs/specification/openapi-extensions/) for further details;
  - `plugins`: allows setting up the different plugins used by the service:
    - `ajv-formats` (`^2.1.1`): with this option you can configure certain [`ajv-formats`](https://github.com/ajv-validator/ajv-formats)Â configurations
      - `formats`: a list of strings used to setup the formats that should be allowed when validating schemas

An example of service options is the following:

```js
const serviceOptions = {
  ajv: {
    plugins: {
      'ajv-formats': { formats: ['date-time'] },
    },
    vocabulary: ['x-name'],
  },
}
module.exports = customService(async function myService(service) {
  ...
}, serviceOptions)
```
