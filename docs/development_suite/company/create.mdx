---
id: create
title: Create a Company
sidebar_label: Create a Company
---

import Tabs from "@theme/Tabs";
import TabItem from "@theme/TabItem";

A company is a resource that provides governance on all the projects it contains. 

Within a company, it is possible to:
- configure the infrastructure on which new projects will be based; 
- analyze the configuration of all existing projects;
- manage users and permissions.

#### Saas
To create a new company in the Mia-Platform SaaS Console, open a [Service Request](https://makeitapp.atlassian.net/servicedesk/customer/portal/21/group/79/create/340) and the company will be created for you.

#### On-Premise 
Before creating a new company in a Mia-Platform On-Premise Console installation, contact your Mia-Platform referent.

:::caution
Remember that the possibility of adding new companies may depend on the type of license you have subscribed to. 

Only a limited amount of companies may be available for creation within your license terms.
:::

Once you made sure you meet all the necessary requirements to create a new company, you can continue with this guide.

<br/>

The next steps will guide you through all the processes to create and correctly configure a new company.
 
### Requirements

To create and configure a company, you must have:

- access to the Console CMS (granted by the `console_cms` group)
- `Console Super User` role, or `console.root.company.create` permission

## Create a company from API

You can create a new company by making a POST request to the `/api/backend/companies` API. 

:::info
This API is visible inside the Console API Portal, under the `Companies` tag.
:::

You will be asked to set the **name** and the **description** of the company to add (only name is required). 

In addition, you will be added as the first Company user with the role of [`Company Owner`](/docs/development_suite/identity-and-access-management/console-levels-and-permission-management#users-capabilities-inside-console).

##### Example call
```bash
curl 
  --request POST \ 
  --url https://{CONSOLE_HOST}/api/backend/companies \
  --header 'Accept: application/json' \
  --header 'Content-Type: application/json'
```
where `CONSOLE_HOST` is the base path of your Console installation.

## Create a company from CMS

It is also possible to manually create a company from the Console CMS. 

However, you will lose some of the automations provided by the company creation API, such as adding the first user, or providing a company unique identifier.

:::danger
It is recommended to use the API to create a new company. Use this method only if strictly necessary.
:::

<details>
<summary>Detailed guide</summary>

#### Create the company

Visit the Console CMS page and open the `Companies` section.

Click the `Add new` button, you will be asked to provide an **id**, a **name** and a **description** for the company (only id and name are required). 

You will be able to set all the optional fields after the creation of the company.
For further information regarding other configuration fields, visit the dedicated [section](#default-configuration-for-a-new-project) later in this page.

#### Add the first Company User

Once your company has been created using CMS, you need to associate the first user to be able to access the company from the Console. 
The first user may either be yourself or another user in the Platform. 

Regardless, head over to the CMS page and click the `Bindings` menu item.

:::caution
Only a restricted set of users have access to the users management section in CMS, ask your Console Administrator if you need the right permissions to access this functionality.
:::

In the `Bindings` section, click the `Add new` button and fill in the form:
- type a custom **Binding ID**

:::danger
The _Binding ID_ must be unique in the whole collection!  

As a general recommendation we suggest `{companyId}-{desiredRole}`, however, in some cases a more complex structure may be necessary.
:::

- select the proper **Role** (since it is the first user, it is recommended to set the role [`Company Owner`](/docs/development_suite/identity-and-access-management/console-levels-and-permission-management#users-capabilities-inside-console).)

- select the correct user as **Subject**

- assign the correct **Resource** by filling it with an object as follows:

```json
{
  "resourceType": "company",
  "resourceId": "{THE COMPANY ID YOU PROVIDED UPON CREATION}"
}
```

</details>

## Company Configuration

Once you create a company, you can configure:

- [clusters](/docs/development_suite/clusters-management/clusters-overview-setup)
- [providers](/docs/development_suite/set-up-infrastructure/providers-management) (git providers, secret managers, CI/CD tools)
- projects default configurations (such as environments, logical layers and accessible namespaces)

:::info
Each of these configurations will be applied as the default configuration to newly created projects within the company.
:::

Let's now proceed with each step of the configuration:

### Connect a cluster

Clusters can be connected to a company from the **Clusters** section of the Console, inside the Company Overview area.

To connect a cluster, you can follow the [clusters connection guide](/development_suite/clusters-management/add-edit-remove-cluster.md).

### Configure Providers

Git providers, Secret Managers and CI/CD tools can be configured from the **Providers** section of the Console, inside the Company Overview area.

For further details on how to create new providers, you can follow the [providers configuration guide](/docs/development_suite/set-up-infrastructure/configure-provider.mdx).

### Projects Default Configurations

By editing the company data model, you will be able to set default configurations for all the projects that will be created within the company.

:::info
This configuration can be done from the `Companies` section of the Console CMS.
:::

The projects default configurations fields are:

- **defaultTemplateId**:
  
  The identifier of the default template to be used for the creation of a project. 
  This information can be changed for a specific project during the steps of the project creation wizard.

- **cmsImageName**:
  
  The Docker image configuring the CMS used in your project. It should also contain the CMS tag to be used.
  This value will interpolate the template archive of your project.
  
  If `cms-site` service is disabled during the project creation, this field will not be used.

- **repository** (_required_):
  
  An object that specifies the information regarding the repository where the projects of this company will be created. 

  :::info
  This field can also be set by [selecting a default git provider](/docs/development_suite/set-up-infrastructure/providers-management#set-a-default-provider) in the **Providers** section of the Console.
  :::
  
  The object must have the following properties:

  - **providerId** (_required_): unique identifier of the git provider associated with the company 
  
    It corresponds to the `providerId` field of the provider's CRUD collection, and it is used to retrieve information about the provider. 

    Check out the complete list of [supported providers](/docs/development_suite/set-up-infrastructure/providers-management);
  
  - **basePath**: base path where the project will be created. 
    
    :::caution
    Make sure your configured Git Provider has the right permissions for creating projects on the configured path.
    :::

    Here some tips on how to correctly configure the _basePath_ property, grouped by Git provider:

    <Tabs>

    <TabItem value="gitlab" label="GitLab" default>

      It corresponds to the **basePath of the group** where to create the project.

      If the group does not exist, the project will be created only if the user has the needed permission to create the group in its parent.

      For example, if your group is reachable at the URL **`https://my-gitlab-host.eu/mia-platform/projects`**, <br/>
      then the `basePath` must be **`mia-platform/projects`**.
      
      If your group does not exist (groupB in the example):

      - /groupA/groupB -> if user have permission to create groups in groupA, then groupB will be created;
      - /groupA/groupB -> if user have no permission to create groups in groupA, then groupB will NOT be created;
      - /groupA/groupB -> if groupA does not exist, then it will NOT be created any group.

    </TabItem>

    <TabItem value="github" label="GitHub">

      It corresponds to the **path of an existing organization**. 
      
      If the path does not exist, the project will not be created.

      For example, if your organization is reachable at the URL **`https://github.com/mia-platform`**, <br/>
      then the `basePath` must be **`mia-platform`**

    </TabItem>

    <TabItem value="azure-devops" label="Azure DevOps">

      It corresponds to the **path where your Azure project is reachable**: the pattern is _company-name/project-name_.
      
      For example, if you project is reachable at the URL **`https://dev.azure.com/mia-platform-devops/Test`**, <br/>
      then the `basePath` must be **`mia-platform-devops/Test`**.

    </TabItem>

    <TabItem value="bitbucket" label="Bitbucket">

      It corresponds to the **path where your Bitbucket project is reachable**: the pattern is _projects/project-code_.

      For example, if you project is reachable at the URL **`https://bitbucket.mia-platform.eu/projects/Test`**, <br/>
      then the `basePath` must be **`projects/Test`**.

    </TabItem>

    </Tabs>
      
  - **visibility**: visibility of the project. Either one of the following:

    - `public`: the repository can be accessed and viewed by anyone, including non-authenticated users;
    - `internal`: the repository can be accessed and viewed by any authenticated user within the same git provider instance or organization;
    - `private`: the repository can only be accessed and viewed by users who have been explicitly granted access by the repository owner.

  <br/>

  ##### Example Configurations

  <Tabs>
  <TabItem value="gitlab" label="GitLab">

    ```json
    {
      "providerId": "my-gitlab",
      "type": "gitlab",
      "visibility": "public",
      "basePath": "Mia-Platform/projects"
    }
    ```

  </TabItem>
  <TabItem value="github" label="Github">

    ```json
    {
      "providerId": "my-github",
      "type": "github",
      "visibility": "internal",
      "basePath": "Mia-Platform"
    }
    ```

  </TabItem>
  <TabItem value="azure-devops" label="Azure DevOps">

    ```json
    {
      "providerId": "my-azure-devops",
      "type": "azure-devops",
      "visibility": "private",
      "basePath": "Mia-Platform-devops/Test"
    }
    ```

  </TabItem>
  <TabItem value="bitbucket" label="Bitbucket">

    ```json
    {
      "providerId": "my-bitbucket",
      "type": "bitbucket",
      "visibility": "internal",
      "basePath": "projects/Test"
    }
    ```

  </TabItem>
  </Tabs>

- **pipelines** (_required_):
  
  An object that specifies the information regarding the CI/CD pipelines used by the company. 

  :::info
  This field can also be set by [selecting a default CI/CD tool](/docs/development_suite/set-up-infrastructure/providers-management#set-a-default-provider) in the **Providers** section of the Console.
  :::
  
  The object must have the following properties:

  - **providerId**: unique identifier of the CI/CD tool associated with the company.
    
    It corresponds to the `providerId` field of the provider's CRUD collection, and it is used to retrieve information about the provider. 

  - **type** (_required_): one of the supported provider types. Check out the complete list of [supported providers](/docs/development_suite/set-up-infrastructure/providers-management);

  In addition, it can include the following properties, supported only by specific providers:

  <Tabs>
  <TabItem value="azure-devops" label="Azure DevOps">

    - **azurePipelineId**: unique identifier that can be used to reference and identify a pipeline.

    Learn more on how to retrieve the ID of a pipeline on the Azure DevOps [pipelines documentation](https://learn.microsoft.com/en-us/azure/devops/pipelines).

  </TabItem>
  <TabItem value="jenkins" label="Jenkins">

    - **options**: an object containing the view configuration property.

      In Jenkins, pipeline views allow you to visualize and monitor your pipelines and their status in a more organized and user-friendly way, making it easier to track their progress and health.

      The **view** configuration includes the following fields: 

      - **name**: name of the visualization step where Jenkins pipelines are shown.
  
  </TabItem>
  </Tabs>

  ##### Example Configuration

  <Tabs>
  <TabItem value="gitlab" label="GitLab">

  ```json
  {
    "providerId": "my-gitlab",
    "type": "gitlab-ci"
  }
  ```
  </TabItem>
  <TabItem value="github" label="Github">
  
  ```json
  {
    "providerId": "my-github",
    "type": "github-actions"
  }
  ```
  </TabItem>
  <TabItem value="azure-devops" label="Azure DevOps">
  
  ```json
  {
    "providerId": "my-azure",
    "type": "azure-pipelines",
    "azurePipelineId": "{PIPELINE_ID}"
  }
  ```
  </TabItem>
    <TabItem value="jenkins" label="Jenkins">
  
  ```json
  {
    "providerId": "my-jenkins",
    "type": "jenkins",
    "options": {
      "view": { "name": "my-view" }
    }
  }
  ```
  </TabItem>
  </Tabs>

- **environmentsVariables**:
   
  An object that describes the configuration to enable the Variables section in the Project Settings area of the Console.

  :::info
  This field can also be set by [selecting a default secret manager](/docs/development_suite/set-up-infrastructure/providers-management#set-a-default-provider) in the **Providers** section of the Console.
  :::

  :::caution
  This field is not required. However, by leaving an empty configuration you will need to manually configure a secret manager for each project you create.
  :::

  The object can be configured with the following properties:

  - **providerId**: unique identifier of the secret manager associated with the company. 
  
    It corresponds to the `providerId` field of the provider's CRUD collection, and it is used to retrieve information about the provider. 

  - **type** (_required_): one of the supported provider types. Check out the complete list of [supported providers](/docs/development_suite/set-up-infrastructure/providers-management);

  In addition, it can include the following properties, supported only by specific providers:

  <Tabs>
  <TabItem value="gitlab" label="GitLab">
  
  - **baseUrl**: base path from which the variables will be read. 

    If not specified, variables will be read from the first parent group of the Configurations project in GitLab.

    As an example, if your GitLab project is saved in **`https://git.tools.mia-platform.eu/mia-platform/Test/configurations`**, the environment variables will be written in the **`mia-platform/Test`** group.

  - **storage**: additional settings related to the storage of environment variables within the GitLab installation.

    It is composed by the following properties:

    - **path**: TODO

    - **type**: TODO

      Either one of the following:

      - `groups`: TODO
      - `projects`: TODO

    <br/>
    
  :::info
  This configuration is saved only within the company model, and is retrieved by projects at runtime. 

  If in your company all the environment variables are set to be located in the parent group, by editing this field you can safely change the variables path for all the projects in the company.
  :::

  </TabItem>
  </Tabs>

  ##### Example Configurations

  <Tabs>
  <TabItem value="gitlab" label="GitLab">

  ```json
  {
    "providerId": "my-gitlab",
    "type": "gitlab",
    "baseUrl": "https://my-gitlab-host",
    "storage": {
      "type": "projects",
      "path": "clients/mia-platform/configurations"
    }
  }
  ```

  </TabItem>
  <TabItem value="vault" label="Vault">

  ```json
  {
    "providerId": "my-vault",
    "type": "vault"
  }
  ```
  </TabItem>
  </Tabs>

- **environments** (_required_):
  
  An array of objects containing the definitions of the environments for the company.

  :::note
  The content of this array will be interpolated during project creation by replacing `%projectId%` strings with the `projectId` field specified in the project.
  :::

  Each object is shaped as follows:

  - **label**: descriptive human-readable identifier for the environment;  
  - **envId** (_required_): unique identifier associated with the environment;
  - **envPrefix**: defines a common prefix for environment-specific variables;
  - **description**: short description of the environment;
  - **isProduction**: boolean value indicating whether it is considered to be a production environment;
  - **hosts**: an array of objects identifying the hosts used by the environment.
  
    Each host is shaped as follows:

    - **host**: URL identifying where the host is located;
    - **isBackoffice**: boolean value indicating whether the host is a CMS instance;
    - **scheme**: the URL schema, typically either _http_ of _https_.

    This object can be used to specify where a specific environment should be hosted,
    where it should expose its documentation or where to access its CMS.

  <!-- - **links**: an array of objects containing a series of useful links.

    Each link is shaped as follows:

    - **id**: unique identifier associated with the link;
    - **url** (_required_): link redirection URL. -->

  - **dashboards**: an array of objects identifying environments metrics and performance indicators.

    Each dashboard is shaped as follows:

      - **id** (_required_): unique identifier associated with the dashboard;
      - **label** (_required_): descriptive human-readable identifier for the dashboard;  
      - **url** (_required_): URL from which the metrics are retreived;
      - **type** (_required_): defines the integration method of the dashboard in the Console.
  
        Either one of the following: 
        
        - **iframe**: the dashboard will be included within the Console UI;
        - **newTab**: the dashboard will open on a new browser tab.

      - **category**: indicates the group in which the dashboard will be presented in the Console UI.
  
  - **environmentsVariables**: an object that describes the configuration of variables for the environment.
    
    :::info
    This field overrides the configuration provided in the `environmentsVariables` field for a specific environment. 
    :::

    It can be configured following the configuration of the `environmentsVariables` company field.

  - **deploy**: an object that describes the configuration of CI/CD pipelines for the environment.
    
    :::info
    This field overrides the configuration provided in the `pipelines` field for a specific environment. 
    :::

    It can be configured following the configuration of the `pipelines` company field.

    In addition, it can include the following properties, supported only by specific providers:

    <Tabs>
    <TabItem value="github" label="Github">

     - **statusWebhookSecretCredentialsId**: TODO add?

    </TabItem>
    <TabItem value="jenkins" label="Jenkins">

     - **jobId**: TODO
     - **paramsMap**: TODO

    </TabItem>
    </Tabs>
  
  - **cluster**: an object identifying the connection parameters of the cluster the enviroment is deployed to.

    It contains the following properties: 

      - **clusterId**: unique identifier associated with the Kubernetes cluster;
      - **namespace**: name of the logical partitioning the cluster refers to;
      - **kubeContextVariables**: an object containing configuration variables for the Kubernetes context.

        It is composed by the following variables:

          - **KUBE_URL**: URL or endpoint used to access the cluster;

          - **KUBE_TOKEN**: authentication token required to authenticate and authorize access to the cluster.
          
          - **KUBE_CA_PEM**: PEM-encoded certificate authority. 
            
            It is used to verify the authenticity of the cluster's TLS certificate during secure communication.

  :::danger
  The values saved here are not encrypted!

  Do not set the `cluster.kubeContextVariables` with plain values to access the cluster.

  Instead, prefer the use of an interpolated value. By specifying a variable key name (as shown in the example), the value will be taken from the corresponding project variable. 
  :::
  
  ##### Example Configuration
  
  ```json
  [
    {
      "label": "Development",
      "envId": "development",
      "envPrefix": "development",
      "isProduction": false,
      "hosts": [
        {
          "host": "%projectId%.test.mia-platform.eu",
          "scheme": "https"
        },
        {
          "host": "cms.%projectId%.test.mia-platform.eu",
          "isBackoffice": true
        }
      ],
      "cluster": {
        "clusterId": "human-readable-id-of-the-cluster",
        "namespace": "%projectId%-development",
        "kubeContextVariables": {
          "KUBE_URL": "KUBE_DEV_URL",
          "KUBE_TOKEN": "KUBE_DEV_TOKEN",
          "KUBE_CA_PEM": "KUBE_DEV_CA_PEM",
        }
      }
    }
  ]
  ```

- **logicalScopeLayers**:
   
  An array of objects identifying the set of logical layers available in the current company. 
  
  Each object is shaped as follows:

  - **name**: identifies the name of the logical layer;
  - **order**: identifies the numerical order of the layer, used to display layers according to the sorting order defined by the user.

  The `logicalScopeLayers` field will be created in the project model according to the project `layerId` value. Please refer to the [Create a Project](docs/development_suite/set-up-infrastructure/create-project) section for further details.

  ##### Example Configuration
  ```json
  [
    { "name": "layer-1", "order": 2}, 
    { "name": "layer-2", "order": 1}
  ]
  ```

- **availableNamespaces**:
  
  Namespaces internally accessible from your project, using the `cross-projects` endpoint. 
  
  Namespaces are useful when your company is made up of several projects that communicate with each other.

  :::note
  The content of this array will be interpolated during project creation by replacing `%projectId%` strings with the `projectId` field specified in the project.
  :::

  Each object is shaped as follows:

    - **value**: the identifier of the namespace;
    - **label**: an alias for the namespace to be displayed inside the project.

  <br/>

  ##### Example Configuration
  ```json
  [
    { "value": "dev.%projectId%", "label": "Development"}, 
    { "value": "preprod.%projectId%", "label": "Preproduction"}, 
  ]
  ```

- **dockerImageNameSuggestion**:
  
  An object defining the Docker image name suggestion that will be passed to every project created in your company. 
  
  :::info
  This suggestion will appear in the `Docker Image Name` field when you [create a microservice](/development_suite/api-console/api-design/services.md#how-to-create-a-microservice-from-an-example-or-from-a-template).
  :::

  The object should have the following properties:

  - **type** (_required_): string which defines the format of the suggestion. Currently, there exist three types:

    - `PROJECT_ID` (_default_): **`<project-id>/<your-service-name>`**

      This is the default behaviour, suggestions will follow this format when this field is not set. Do **not** set the _prefix_ property if you choose this type of suggestion.

    - `REPOSITORY`: **`<your-group-name>/<your-repo-name>`**

      Do **not** set the _prefix_ property if you choose this type of suggestion.

    - `CONSTANT_PREFIX`: **`<prefix-value>/<your-service-name>`**. 

      The _prefix_ property is required for this type and will replace _prefix-value_.

  - **prefix**: defines the prefix that will appear in the suggestion for the Docker image name. 
  
    This property must be defined only when **type** property value is set to `CONSTANT_PREFIX`.

  ##### Example Configuration
  ```json
  {
    "type": "CONSTANT_PREFIX",
    "prefix": "my-docker-image"
  }
  ```

- **imagePullSecretNames**:
  
  A list of imagePullSecret names. 
  
  :::note
  An imagePullSecret is a Kubernetes entity used to authenticate and authorize access to private container image registries. 
  :::

  The imagePullSecrets whose name is specified in this field will be inherited in the project during project creation and then used in deployment and cronjob files for pulling Docker images.

  ##### Example Configuration
  ```json
  [
    "my-imagepullsecret"
  ]
  ```

- **enabledSecurityFeatures**:
  
  A set of features to enforce the security of the project. 

  It defines the security features and settings that will be applied to the Kubernetes environment that your project will be deployed on.

  The object can be configured with the following properties:

  - **`seccompProfile`**: indicates whether the Seccomp profile is enabled. 
    
    Seccomp (short for secure computing mode) is a Linux kernel feature that restricts the system calls a process can make. Enabling Seccomp profiles helps enhance the security of containers by limiting their access to potentially dangerous system calls.

  - **`appArmor`**: indicates whether AppArmor is enabled. 
    
    AppArmor is a Linux security module that provides mandatory access control (MAC) policies. It allows you to define fine-grained restrictions on the actions that a process can perform, helping to prevent unauthorized activities and limit the potential impact of security breaches.

  - **`hostProperties`**: indicates whether the container has access to host properties. 
    
    Host properties typically include information about the underlying host system, such as network interfaces, file systems, or hardware details. Disabling access to host properties helps isolate the container from the host environment, reducing the risk of information leakage or unauthorized system access.

  - **`privilegedPod`**: indicates whether the container or pod has privileged access. 
    
    Privileged access means that the container or pod has elevated permissions and can perform privileged operations on the host system. Disabling privileged access is generally recommended for improved security, as it helps prevent containers from having unrestricted control over the underlying infrastructure.

  ##### Example Configuration
  ```json
  {
    "seccompProfile": false,
    "appArmor": false,
    "hostProperties": true,
    "privilegedPod": false
  }
  ```
